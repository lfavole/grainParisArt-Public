{% extends "base.html" %}
{% load format_runtime %}
{% load tojson %}
{% load l10n %}
{% load static %}

{% block head %}

{% endblock %}

{% block body %}

<a href="#headerTop">
    <div class="goTop">
        <p>üçø</p>
    </div>
</a>

<img src="../static/images/background.svg" class="background_svg">


<div id="map"></div>

<div class="planning">
    <div class="container_titrePlanning">
        <div class="contenu_edt">
            <h2 class="txt_edt">Emploi du temps</h2>
            <div class="calendrier">
            {% for delta, date in dates %}
                {% if date == current_date %}
                <div class="date-selectionne">
                    <p class="jour">{{date|date:"D"}}</p>
                    <p class="chiffre">{{date.day}}</p>
                    <p class="mois">{{date|date:"N"}}</p>
                </div>
                {% else %}
                <a href="{% url "home" %}?delta={{ delta }}">
                    <div class="date">
                        <p class="jour">{{date|date:"D"}}</p>
                        <p class="chiffre">{{date.day}}</p>
                        <p class="mois">{{date|date:"N"}}</p>
                    </div>
                </a>
                {% endif %}
            {% endfor %}
            </div>
        </div>
        <div class="line"></div>
    </div>
    {% static "images/nocontent.png" as default_poster %}
    {% for film in films %}
    <div class="container_infoFilm">
        <img src="{% firstof film.poster default_poster %}" class="affiche" />
        <div class="infoFilm">
            <div class="blur-background"></div>
            <div>
                <h3 class="titreFilm"><a href="{{ film.url }}">{{ film.title }}</a></h3>
                <div class="info-content">
                    <p class="realisateur">R√©alisateur : {{film.director}}</p>
                    <p class="casting">Casting : {{ film.cast }}</p>
                    <p class="genre">Genre : {{ film.genres }}</p>
                    <p class="duree">Dur√©e : {{ film.runtime | format_runtime }}</p>
                </div>
                <div class="synopsis_container">
                    <p class="synopsis">
                        {{ film.synopsis }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div style="height: 10px;"></div>
    {% regroup film.showtime_set.all by theater as theaters %}
    {% for theater in theaters %}
    <div class="seance_container">
        <div class="cinema">
            <p>{{ theater.grouper.name }}</p>
        </div>
        <div class="horaires_container">
            {% for showtime in theater.list %}
            <div class="horaire">
                <p>{{ showtime.start_time|time:"H:i" }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="responsive-petite-div"></div>
    {% endfor %}
    <div class="responsive-div"></div>
    {% endfor %}

</div>



<script>
    mapboxgl.accessToken = {{ mapbox_token | tojson }};

    var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v11",
        center: [2.3522, 48.8566],
        zoom: 12
    });

    map.addControl(new mapboxgl.NavigationControl());

    var locations = {{ theater_locations | tojson }};

    locations.forEach(function (location) {
        var el = document.createElement("div");
        el.className = "custom-marker";

        var popup = new mapboxgl.Popup({ offset: 25 }).setText(location.description);

        new mapboxgl.Marker(el)
            .setLngLat(location.coordinates)
            .setPopup(popup)
            .addTo(map);
    });
</script>


{% endblock %}